<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>World Cup Concierge • Super Admin</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#0b0f17;color:#e8edf7}
    header{padding:18px 20px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;align-items:center;justify-content:space-between}
    .pill{padding:6px 10px;border:1px solid rgba(255,255,255,.14);border-radius:999px;font-size:12px;opacity:.9}
    main{padding:18px 20px;max-width:1100px;margin:0 auto}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px}
    h2{margin:0 0 8px 0;font-size:15px;letter-spacing:.2px}
    pre{white-space:pre-wrap;word-break:break-word;background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.08);padding:10px;border-radius:12px;margin:10px 0 0 0}
    .muted{opacity:.75;font-size:12px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px 6px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left}
    th{opacity:.8;font-weight:600}
  </style>
</head>
<body>
  <header>
    <div>
      <div style="font-weight:700;letter-spacing:.2px">Super Admin</div>
      <div class="muted">Cross-venue visibility (read-only)</div>
    </div>
    <div class="pill">v{{ version }}</div>
  </header>

  <main>
    <div class="grid">
      <div class="card">
        <h2>Overview</h2>
        <div id="summary" class="muted">Loading…</div>
      </div>
      <div class="card">
        <h2>Queue totals</h2>
        <div id="totals" class="muted">Loading…</div>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <h2>By venue</h2>
      <div class="muted">AI Queue counts by status. (Leads cross-venue is handled by /admin/api/leads_all with super_key.)</div>
      <div style="overflow:auto;margin-top:10px">
        <table id="byVenueTbl">
          <thead>
            <tr>
              <th>Venue</th>
              <th>Pending</th>
              <th>Approved</th>
              <th>Denied</th>
              <th>Overridden</th>
              <th>Other</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <pre id="raw" style="display:none"></pre>
    </div>
  </main>

<script>
(function(){
  const params = new URLSearchParams(window.location.search);
  const key = params.get("key") || "";
  async function load(){
    const url = "/super/api/overview?key=" + encodeURIComponent(key);
    const res = await fetch(url, {headers: {"Accept":"application/json"}});
    const data = await res.json().catch(()=>({ok:false,error:"bad_json"}));
    if(!data.ok){
      document.getElementById("summary").textContent = "Unauthorized / error: " + (data.error || "unknown");
      document.getElementById("totals").textContent = "";
      return;
    }
    const venues = (data.venues || []);
    document.getElementById("summary").textContent = "Venues: " + venues.length;
    document.getElementById("totals").textContent = "Queue items: " + (data.totals && data.totals.queue || 0);

    const tbody = document.querySelector("#byVenueTbl tbody");
    tbody.innerHTML = "";
    venues.forEach(v=>{
      const q = (data.by_venue && data.by_venue[v] && data.by_venue[v].queue) || {};
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${v}</td>
        <td>${q.pending||0}</td>
        <td>${q.approved||0}</td>
        <td>${q.denied||0}</td>
        <td>${q.overridden||0}</td>
        <td>${q.other||0}</td>
      `;
      tbody.appendChild(tr);
    });
  }
  load();
})();
</script>
</body>
</html>
