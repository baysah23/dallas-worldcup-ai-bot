<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>World Cup 2026 Dallas Concierge</title>

  <style>
    :root{
      --bg:#071022;
      --panel:#0f1b33;
      --panel2:#0b152c;
      --line:rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted:#b9c7ee;
      --accent:#2ea043;
      --accent2:#1f6feb;
      --warn:#ffcc66;
    }
    body{
      margin:0; height:100vh; display:flex; flex-direction:column;
      font-family: Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 10%, #132a5b 0%, var(--bg) 55%);
      color:var(--text);
    }
    .wrap{max-width:1050px; width:100%; margin:0 auto; display:flex; flex-direction:column; height:100%;}
    header{
      padding:16px 18px;
      background: linear-gradient(90deg, #0b1733 0%, #0f1b33 55%, #102246 100%);
      border-bottom:1px solid var(--line);
    }
    .toprow{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .brand{display:flex; gap:12px; align-items:center;}
    .badge{
      width:44px; height:44px; border-radius:12px;
      background: linear-gradient(135deg, #f5d76e 0%, #2ea043 45%, #1f6feb 100%);
      box-shadow: 0 10px 35px rgba(0,0,0,.25);
    }
    h1{margin:0; font-size:16px; font-weight:800; letter-spacing:.2px;}
    .sub{margin:6px 0 0; color:var(--muted); font-size:12px;}
    .langbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
    .langbtn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:8px 10px;
      border-radius:10px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .langbtn.active{background:rgba(46,160,67,.18); border-color:rgba(46,160,67,.45);}

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:14px;
      padding:14px;
      flex:1;
      min-height:0;
    }
    @media (max-width: 950px){
      .grid{grid-template-columns:1fr;}
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(255,255,255,.03) 100%);
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      min-height:0;
    }
    .cardhead{
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: rgba(0,0,0,.12);
    }
    .cardhead .title{font-weight:800; font-size:13px;}
    .pill{
      font-size:11px;
      color:var(--muted);
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      background:rgba(0,0,0,.12);
      white-space:nowrap;
    }

    .banner{
      padding:10px 14px;
      border-bottom:1px dashed rgba(255,255,255,.16);
      color:var(--warn);
      font-size:12px;
      display:none;
    }
    .banner.show{display:block;}

    #chat{
      padding:14px;
      height:100%;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .bubble{
      max-width:78%;
      padding:10px 12px;
      border-radius:14px;
      line-height:1.35;
      white-space:pre-wrap;
      word-wrap:break-word;
      border:1px solid rgba(255,255,255,.10);
    }
    .user{
      align-self:flex-end;
      background: rgba(31,111,235,.22);
      border-color: rgba(31,111,235,.35);
    }
    .bot{
      align-self:flex-start;
      background: rgba(0,0,0,.18);
    }

    .composer{
      display:flex;
      gap:10px;
      padding:12px 14px;
      border-top:1px solid var(--line);
      background: rgba(0,0,0,.12);
      align-items:center;
    }
    textarea{
      flex:1;
      resize:none;
      height:44px;
      max-height:130px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color:var(--text);
      padding:10px 12px;
      font-size:14px;
      outline:none;
    }
    button{
      background: var(--accent);
      border:none;
      padding:10px 14px;
      border-radius:12px;
      font-size:14px;
      font-weight:800;
      color:#fff;
      cursor:pointer;
      min-width:92px;
    }
    button:disabled{opacity:.6; cursor:not-allowed;}

    button.secondary{
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      color: var(--text);
      min-width:92px;
    }
    button.secondary:hover{background: rgba(255,255,255,.16);}

    .sidepad{padding:12px 14px;}
    .countdown{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 14px;
      border-bottom:1px solid var(--line);
    }
    .countdown .label{font-size:12px; color:var(--muted); font-weight:700;}
    .countdown .nums{
      display:flex;
      gap:10px;
      align-items:baseline;
      font-weight:900;
      font-size:13px;
      white-space:nowrap;
    }
    .nums span{color:var(--text);}
    .nums b{color:#f5d76e;}

    .schedule{max-height:260px; overflow:auto;}
    .match{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.10);
      font-size:12px;
    }
    .match .left{display:flex; flex-direction:column; gap:2px;}
    .match .when{color:var(--muted);}
    .match.next{
      background: rgba(46,160,67,.18);
      border-top:1px solid rgba(46,160,67,.35);
    }

    .matchday{
      margin:12px 14px 0;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(245,215,110,.35);
      background: rgba(245,215,110,.10);
      font-size:12px;
      display:none;
    }
    .matchday.show{display:block;}

    .menu{
      border-top:1px solid rgba(255,255,255,.10);
      padding:10px 12px;
      font-size:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .menuitem{
      padding:8px 10px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      background: rgba(0,0,0,.14);
    }
    .menuitem .name{font-weight:800;}
    .menuitem .desc{color:var(--muted); margin-top:3px;}
    .menuitem .price{margin-top:6px; font-weight:800; color:#f5d76e;}

    .hint{
      padding:10px 14px;
      font-size:12px;
      color:var(--muted);
      border-top:1px dashed rgba(255,255,255,.14);
    }
    code{background:rgba(255,255,255,.10); padding:2px 6px; border-radius:8px;}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="toprow">
        <div class="brand">
          <div class="badge" aria-hidden="true"></div>
          <div>
            <h1>World Cup 2026 ‚Ä¢ Dallas Match-Day Concierge</h1>
            <div class="sub">Reserve tables, see Dallas match schedule, and chat in English ‚Ä¢ Espa√±ol ‚Ä¢ Portugu√™s ‚Ä¢ Fran√ßais</div>
          </div>
        </div>

        <div class="langbar" aria-label="Language toggle">
          <div class="langbtn active" data-lang="en">English</div>
          <div class="langbtn" data-lang="es">Espa√±ol</div>
          <div class="langbtn" data-lang="pt">Portugu√™s</div>
          <div class="langbtn" data-lang="fr">Fran√ßais</div>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- Chat -->
      <div class="card" style="display:flex;flex-direction:column;min-height:0;">
        <div class="cardhead">
          <div class="title" id="chatTitle">Chat</div>
          <div class="pill" id="pillMode">Mode: Standard</div>
        </div>

        <div class="banner" id="matchBanner"></div>
        <div id="chat"></div>

        <div class="composer">
          <textarea id="msg" placeholder="Type your message... (Enter to send, Shift+Enter for new line)"></textarea>
          <button id="sendBtn">Send</button>
          <button id="clearBtn" class="secondary" title="Clear chat">Clear</button>
        </div>

        <div class="hint" id="helperHint"></div>
      </div>

      <!-- Sidebar -->
      <div class="card" style="display:flex;flex-direction:column;min-height:0;">
        <div class="cardhead">
          <div class="title" id="sideTitle">Dallas Schedule + Menu</div>
          <div class="pill" id="pillLang">EN</div>
        </div>

        <div class="countdown">
          <div>
            <div class="label" id="countLabel">World Cup countdown</div>
            <div class="sub" style="margin:4px 0 0;" id="countSub">Dallas / Arlington match days</div>
          </div>
          <div class="nums" id="countNums">
            <span><b id="d">0</b>d</span>
            <span><b id="h">0</b>h</span>
            <span><b id="m">0</b>m</span>
            <span><b id="s">0</b>s</span>
          </div>
        </div>

        <div class="matchday" id="matchdayBox"></div>

        <div class="sidepad" style="padding-bottom:0;">
          <div class="pill" style="display:inline-block;" id="nextHint">Next upcoming match is highlighted</div>
        </div>

        <div class="schedule" id="schedule"></div>

        <div class="cardhead" style="border-top:1px solid var(--line); border-bottom:none;">
          <div class="title" id="menuTitle">Menu</div>
          <div class="pill" id="menuPill">4 languages</div>
        </div>

        <div class="menu" id="menu"></div>
      </div>
    </div>
  </div>

<script>
/**
 * This frontend matches your current app.py endpoints:
 *  - GET /schedule.json
 *  - GET /menu.json?lang=en|es|pt|fr
 *  - POST /chat { message, session_id, language }
 *
 * Keeps all original features: language toggle, chat, helper hint,
 * countdown, schedule highlight, match-day banner.
 */

// -----------------------
// Session + state
// -----------------------
let sessionId = (localStorage.getItem("session_id") || (() => {
  const id = "sess_" + Math.random().toString(16).slice(2) + "_" + Date.now();
  localStorage.setItem("session_id", id);
  return id;
})());

let lang = localStorage.getItem("lang") || "en";
let scheduleData = null;
let menuData = null;

// Conversation memory (client-side history) ‚Äî kept as a feature
const history = [];

const chatEl = document.getElementById("chat");
const msgEl = document.getElementById("msg");
const sendBtn = document.getElementById("sendBtn");
const clearBtn = document.getElementById("clearBtn");
const helperHint = document.getElementById("helperHint");
const pillLang = document.getElementById("pillLang");
const pillMode = document.getElementById("pillMode");
const matchBanner = document.getElementById("matchBanner");
const matchdayBox = document.getElementById("matchdayBox");

const STRINGS = {
  en: {
    welcome: "Hi! Want to book a table for a match day? Ask me anything.",
    lang_set: "Language set to English.",
    helper: 'Try: <code>reservation</code> to book ‚Ä¢ <code>Recall reservation so far</code> ‚Ä¢ Ask about the menu ‚Ä¢ Ask about Dallas match days.',
    send: "Send",
    typing: "...",
    chat_title: "Chat",
    side_title: "Dallas Schedule + Menu",
    countdown: "World Cup countdown",
    countdown_sub: "Dallas / Arlington match days",
    next_hint: "Next upcoming match is highlighted",
    schedule_empty: "Schedule coming soon ‚Äî update the match list in <code>app.py</code> (DALLAS_MATCHES).",
    menu_title: "Menu"
  },
  es: {
    welcome: "¬°Hola! ¬øQuieres reservar una mesa para un d√≠a de partido? Preg√∫ntame lo que sea.",
    lang_set: "Idioma cambiado a Espa√±ol.",
    helper: 'Prueba: <code>reserva</code> para reservar ‚Ä¢ <code>Recordar reserva</code> ‚Ä¢ Pregunta por el men√∫ ‚Ä¢ Pregunta por los partidos en Dallas.',
    send: "Enviar",
    typing: "...",
    chat_title: "Chat",
    side_title: "Horario Dallas + Men√∫",
    countdown: "Cuenta regresiva",
    countdown_sub: "D√≠as de partido Dallas / Arlington",
    next_hint: "El pr√≥ximo partido est√° resaltado",
    schedule_empty: "El calendario estar√° disponible pronto ‚Äî actualiza <code>DALLAS_MATCHES</code> en <code>app.py</code>.",
    menu_title: "Men√∫"
  },
  pt: {
    welcome: "Ol√°! Quer reservar uma mesa para dia de jogo? Pergunte qualquer coisa.",
    lang_set: "Idioma definido para Portugu√™s.",
    helper: 'Tente: <code>reserva</code> para reservar ‚Ä¢ <code>Relembrar reserva</code> ‚Ä¢ Pergunte sobre o card√°pio ‚Ä¢ Pergunte sobre jogos em Dallas.',
    send: "Enviar",
    typing: "...",
    chat_title: "Chat",
    side_title: "Agenda Dallas + Card√°pio",
    countdown: "Contagem regressiva",
    countdown_sub: "Dias de jogo Dallas / Arlington",
    next_hint: "O pr√≥ximo jogo est√° destacado",
    schedule_empty: "Agenda em breve ‚Äî atualize <code>DALLAS_MATCHES</code> no <code>app.py</code>.",
    menu_title: "Card√°pio"
  },
  fr: {
    welcome: "Bonjour ! Vous voulez r√©server une table pour un jour de match ? Demandez-moi !",
    lang_set: "Langue d√©finie sur Fran√ßais.",
    helper: 'Essayez : <code>r√©servation</code> pour r√©server ‚Ä¢ <code>Rappeler la r√©servation</code> ‚Ä¢ Demandez le menu ‚Ä¢ Demandez les matchs √† Dallas.',
    send: "Envoyer",
    typing: "...",
    chat_title: "Chat",
    side_title: "Programme Dallas + Menu",
    countdown: "Compte √† rebours",
    countdown_sub: "Jours de match Dallas / Arlington",
    next_hint: "Le prochain match est surlign√©",
    schedule_empty: "Programme bient√¥t disponible ‚Äî mettez √† jour <code>DALLAS_MATCHES</code> dans <code>app.py</code>.",
    menu_title: "Menu"
  }
};

function L(){ return STRINGS[lang] || STRINGS.en; }

function addBubble(role, text){
  const b = document.createElement("div");
  b.className = "bubble " + (role === "user" ? "user" : "bot");
  b.textContent = text;
  chatEl.appendChild(b);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function setSending(isSending){
  sendBtn.disabled = isSending;
  msgEl.disabled = isSending;
  sendBtn.textContent = isSending ? L().typing : L().send;
}

// -----------------------
// Language toggle
// -----------------------
function applyLanguageToUI(){
  pillLang.textContent = lang.toUpperCase();
  document.querySelectorAll(".langbtn").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });

  // Titles + helper
  document.getElementById("chatTitle").textContent = L().chat_title;
  document.getElementById("sideTitle").textContent = L().side_title;
  document.getElementById("countLabel").textContent = L().countdown;
  document.getElementById("countSub").textContent = L().countdown_sub;
  document.getElementById("nextHint").textContent = L().next_hint;
  document.getElementById("menuTitle").textContent = L().menu_title;

  helperHint.innerHTML = L().helper;
  sendBtn.textContent = L().send;
}

async function setLanguage(newLang){
  lang = newLang;
  localStorage.setItem("lang", lang);
  applyLanguageToUI();

  // reload menu in the chosen language
  await loadMenu();

  // show a bot notice (feature preserved)
  addBubble("assistant", L().lang_set + "\n\n" + stripHtml(L().helper));
  history.push({role:"assistant", content: L().lang_set});
}

document.querySelectorAll(".langbtn").forEach(btn => {
  btn.addEventListener("click", () => setLanguage(btn.dataset.lang));
});

// helper: render helper text in bubble without html tags
function stripHtml(html){
  const tmp = document.createElement("div");
  tmp.innerHTML = html;
  return tmp.textContent || tmp.innerText || "";
}

// -----------------------
// Fetchers (match app.py)
// -----------------------
async function loadSchedule(){
  const res = await fetch("/schedule.json", {cache:"no-store"});
  scheduleData = await res.json();
  renderSchedule();
  updateMatchDayMode();
  restartCountdown(); // uses schedule info when available
}

async function loadMenu(){
  const res = await fetch("/menu.json?lang=" + encodeURIComponent(lang), {cache:"no-store"});
  const data = await res.json();
  // app.py returns { lang, menu: {title, items:[]}}
  menuData = data.menu;
  renderMenu(menuData.items || []);
}

function safeParseTimestamp(dateIso, timeStr){
  // app.py schedule items may have "time": "17:00" or missing/""/"TBD"
  if (!dateIso) return null;
  if (timeStr && typeof timeStr === "string" && timeStr.trim() && timeStr.trim().toUpperCase() !== "TBD"){
    // expect "HH:MM"
    const t = timeStr.trim();
    // Basic guard
    if (/^\d{1,2}:\d{2}$/.test(t)){
      return Date.parse(dateIso + "T" + t + ":00");
    }
  }
  // end-of-day fallback
  return Date.parse(dateIso + "T23:59:59");
}

// -----------------------
// Time formatting (display only)
// - Converts "17:00" -> "5:00 PM"
// - Keeps "7:00 pm" but normalizes to "7:00 PM"
// -----------------------
function formatTime12(timeStr){
  if (!timeStr) return "TBD";
  const raw = String(timeStr).trim();
  if (!raw || raw.toUpperCase() === "TBD") return "TBD";

  // Already has AM/PM? Normalize casing and spacing.
  const ampmMatch = raw.match(/\b(am|pm)\b/i);
  if (ampmMatch){
    // Normalize like "7:00 pm" -> "7:00 PM"
    return raw.replace(/\b(am|pm)\b/ig, (m)=>m.toUpperCase()).replace(/\s+/g," ").trim();
  }

  // 24h format "HH:MM"
  const m = raw.match(/^(\d{1,2}):(\d{2})$/);
  if (!m) return raw; // unknown format, leave as-is

  let hh = parseInt(m[1], 10);
  const mm = m[2];
  if (Number.isNaN(hh) || hh < 0 || hh > 23) return raw;

  const ap = (hh >= 12) ? "PM" : "AM";
  hh = hh % 12;
  if (hh === 0) hh = 12;
  return `${hh}:${mm} ${ap}`;
}

// -----------------------
// Countdown
// -----------------------
let countdownTimer = null;

function chooseCountdownTarget(){
  // Prefer next match datetime if present; otherwise fixed World Cup-ish date.
  // If DALLAS_MATCHES is empty, still show a countdown.
  if (scheduleData && scheduleData.next_match && scheduleData.next_match.date){
    const nm = scheduleData.next_match;
    const ts = safeParseTimestamp(nm.date, nm.time);
    if (ts) return new Date(ts);
  }
  // fallback: World Cup June 2026 (safe constant, preserves feature)
  return new Date("2026-06-11T00:00:00");
}

function restartCountdown(){
  if (countdownTimer) clearInterval(countdownTimer);

  const target = chooseCountdownTarget();
  const dEl = document.getElementById("d");
  const hEl = document.getElementById("h");
  const mEl = document.getElementById("m");
  const sEl = document.getElementById("s");

  function tick(){
    const now = new Date();
    let diff = Math.max(0, target - now);

    const days = Math.floor(diff / (1000*60*60*24));
    diff -= days*(1000*60*60*24);
    const hrs = Math.floor(diff / (1000*60*60));
    diff -= hrs*(1000*60*60);
    const mins = Math.floor(diff / (1000*60));
    diff -= mins*(1000*60);
    const secs = Math.floor(diff / 1000);

    dEl.textContent = days;
    hEl.textContent = hrs;
    mEl.textContent = mins;
    sEl.textContent = secs;
  }

  tick();
  countdownTimer = setInterval(tick, 1000);
}

// -----------------------
// Schedule rendering + next match highlight
// -----------------------
function renderSchedule(){
  const el = document.getElementById("schedule");
  el.innerHTML = "";

  const matches = (scheduleData && Array.isArray(scheduleData.matches)) ? scheduleData.matches.slice() : [];

  if (!matches.length){
    const empty = document.createElement("div");
    empty.className = "match";
    empty.innerHTML = `
      <div class="left">
        <div><b>Notice</b></div>
        <div class="when">${L().schedule_empty}</div>
      </div>
      <div class="pill">‚Äî</div>
    `;
    el.appendChild(empty);
    return;
  }

  const enriched = matches.map(m => {
    const ts = safeParseTimestamp(m.date, m.time);
    return {...m, ts};
  }).filter(m => m.ts !== null);

  const now = Date.now();
  const upcoming = enriched.filter(m => m.ts >= now).sort((a,b)=>a.ts-b.ts);
  const nextId = upcoming.length ? upcoming[0].id : null;

  enriched.sort((a,b)=>a.ts-b.ts).forEach(m => {
    const row = document.createElement("div");
    row.className = "match" + (m.id === nextId ? " next" : "");

    const timeTxtRaw = (m.time && String(m.time).trim()) ? String(m.time).trim() : "TBD";
    const timeTxt = formatTime12(timeTxtRaw);
    const teamsTxt = m.teams || (m.home && m.away ? `${m.home} vs ${m.away}` : "TBD vs TBD");
    const venueTxt = m.venue ? ` ‚Ä¢ ${m.venue}` : "";

    row.innerHTML = `
      <div class="left">
        <div><b>Match</b> ‚Ä¢ ${escapeHtml(teamsTxt)}</div>
        <div class="when">${escapeHtml(m.date)} ‚Ä¢ ${escapeHtml(timeTxt)}${escapeHtml(venueTxt)}</div>
      </div>
      <div class="pill">${escapeHtml(m.id || "")}</div>
    `;
    el.appendChild(row);
  });
}

function updateMatchDayMode(){
  const isMatchDay = !!(scheduleData && scheduleData.is_match_day);

  if (isMatchDay){
    pillMode.textContent = "Mode: Match-day";
    const banner = (scheduleData && scheduleData.match_day_banner) ? scheduleData.match_day_banner : "Match-day hours";
    matchBanner.textContent = banner;
    matchBanner.classList.add("show");

    matchdayBox.textContent = "üèüÔ∏è Match-day mode is ON today. Expect higher traffic ‚Äî reserve early!";
    matchdayBox.classList.add("show");
  } else {
    pillMode.textContent = "Mode: Standard";
    matchBanner.classList.remove("show");
    matchdayBox.classList.remove("show");
  }
}

// -----------------------
// Menu rendering
// -----------------------
function renderMenu(items){
  const el = document.getElementById("menu");
  el.innerHTML = "";

  if (!items || !items.length){
    const d = document.createElement("div");
    d.className = "menuitem";
    d.innerHTML = `
      <div class="name">‚Äî</div>
      <div class="desc">Menu not available.</div>
      <div class="price"></div>
    `;
    el.appendChild(d);
    return;
  }

  items.forEach(it => {
    const d = document.createElement("div");
    d.className = "menuitem";
    d.innerHTML = `
      <div class="name">${escapeHtml(it.name || "")}</div>
      <div class="desc">${escapeHtml(it.desc || "")}</div>
      <div class="price">${escapeHtml(it.price || "")}</div>
    `;
    el.appendChild(d);
  });
}

// simple HTML escaping (prevents broken DOM if text contains "<")
function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

// -----------------------
// Chat send
// -----------------------
async function sendMessage(){
  const text = msgEl.value.trim();
  if (!text) return;

  addBubble("user", text);
  history.push({role:"user", content:text});

  msgEl.value = "";
  msgEl.style.height = "44px";
  setSending(true);

  try{
    const res = await fetch("/chat", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        message: text,
        session_id: sessionId,
        language: lang,
        history // kept as a feature; server will safely ignore
      })
    });

    const data = await res.json().catch(() => ({}));
    const reply = (data && data.reply) ? data.reply : "Sorry ‚Äî no reply received.";

    addBubble("assistant", reply);
    history.push({role:"assistant", content: reply});
  } catch(e){
    addBubble("assistant", "‚ö†Ô∏è Network error. Please try again.");
  } finally{
    setSending(false);
    msgEl.focus();
  }
}


// -----------------------
// Clear chat (client-side reset)
// - Clears bubbles + local history
// - Generates a new session_id so the server reservation flow resets too
// -----------------------
function clearChat(){
  chatEl.innerHTML = "";
  history.length = 0;

  const newId = "sess_" + Math.random().toString(16).slice(2) + "_" + Date.now();
  localStorage.setItem("session_id", newId);
  sessionId = newId;

  // Show welcome again after clearing
  addBubble("assistant", L().welcome);
  history.push({role:"assistant", content: L().welcome});

  msgEl.value = "";
  msgEl.style.height = "44px";
  msgEl.focus();

  // Also refresh match-day banner/schedule/menu in case language changed
  applyLanguageToUI();
}

// Wire button
clearBtn && clearBtn.addEventListener("click", clearChat);

sendBtn.addEventListener("click", sendMessage);

// Enter to send, Shift+Enter newline
msgEl.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

// Auto-grow textarea
msgEl.addEventListener("input", () => {
  msgEl.style.height = "44px";
  msgEl.style.height = Math.min(msgEl.scrollHeight, 130) + "px";
});

// -----------------------
// Init
// -----------------------
(async function init(){
  applyLanguageToUI();

  // Load sidebar data
  await loadSchedule();
  await loadMenu();

  // Welcome message (feature preserved)
  addBubble("assistant", L().welcome);
  history.push({role:"assistant", content: L().welcome});

  // Ensure focus
  msgEl.focus();
})();
</script>

</body>
</html>