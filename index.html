<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>World Cup 2026 Dallas Concierge</title>
<style>
    :root{
      --bg:#071022;
      --panel:#0f1b33;
      --panel2:#0b152c;
      --line:rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted:#b9c7ee;
      --accent:#2ea043;
      --accent2:#1f6feb;
      --warn:#ffcc66;
    }
    body{
      margin:0; height:100vh; display:flex; flex-direction:column;
      font-family: Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 10%, #132a5b 0%, var(--bg) 55%);
      color:var(--text);
    }
    .wrap{max-width:1050px; width:100%; margin:0 auto; display:flex; flex-direction:column; height:100%;}
    header{
      padding:16px 18px;
      background: linear-gradient(90deg, #0b1733 0%, #0f1b33 55%, #102246 100%);
      border-bottom:1px solid var(--line);
    }
    .toprow{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .brand{display:flex; gap:12px; align-items:center;}
    .badge{
      width:44px; height:44px; border-radius:12px;
      background: linear-gradient(135deg, #f5d76e 0%, #2ea043 45%, #1f6feb 100%);
      box-shadow: 0 10px 35px rgba(0,0,0,.25);
    }
    h1{margin:0; font-size:16px; font-weight:800; letter-spacing:.2px;}
    .sub{margin:6px 0 0; color:var(--muted); font-size:12px;}
    .langbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap;}
    .langbtn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:8px 10px;
      border-radius:10px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
    }
    .langbtn.active{background:rgba(46,160,67,.18); border-color:rgba(46,160,67,.45);}

    .grid{
      display:grid;
      grid-template-columns: 1.45fr .55fr;
      gap:14px;
      padding:14px;
      flex:1;
      min-height:0;
    }
    @media (max-width: 950px){
      .grid{grid-template-columns:1fr;}
    }

    .leftcol{
      display:grid;
      O0px 1fr; /* Menu | Chat (chat gets more space) */
      gap:14px;
      min-height:0;
      height:100%;
      align-items:stretch;
    }
    .chatcard{display:flex; flex-direction:column; min-height:0;}
    .menucard{display:flex; flex-direction:column; min-height:0;}
    #chat{padding:14px; height:100%; overflow:auto; display:flex; flex-direction:column; gap:10px;}
    .menu{padding:8px 8px 10px; font-size:9px; line-height:1.25; display:flex; flex-direction:column; gap:8px; overflow:auto; max-height:390px;}
    @media (max-width: 950px){
      .leftcol{grid-template-columns: 1fr;}
    }
.card{
      background: linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(255,255,255,.03) 100%);
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      min-height:0;
    }
    .cardhead{
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: rgba(0,0,0,.12);
    }
    .cardhead .title{font-weight:800; font-size:13px;}
    .pill{
      font-size:11px;
      color:var(--muted);
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      background:rgba(0,0,0,.12);
      white-space:nowrap;
    }


    /* -----------------------
       HERO CINEMATIC BANNER
       ----------------------- */
    .hero{ grid-column:1 / -1;
      
      position:relative;
      height:170px;
      border-bottom:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      border-radius:16px;
      margin:12px 12px 10px 12px;
      background: linear-gradient(135deg, rgba(31,111,235,.22), rgba(46,160,67,.14));
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      isolation:isolate;
    }
    /* In compact mode, shorten hero */
    .compact .hero{ grid-column:1 / -1;
       height:120px; margin:10px 10px 8px 10px; border-radius:14px; }

    .heroSlides{
      position:absolute; inset:0;
    }
    .heroSlide{
      position:absolute; inset:0;
      opacity:0;
      transform: scale(1.02);
      transition: opacity 900ms ease, transform 1100ms ease;
      display:flex;
      align-items:stretch;
      justify-content:stretch;
    }
    .heroSlide.active{
      opacity:1;
      transform: scale(1.0);
    }
    .heroSlide::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(800px 220px at 20% 0%, rgba(255,255,255,.16), transparent 60%),
        radial-gradient(900px 260px at 80% 120%, rgba(255,255,255,.10), transparent 55%),
        linear-gradient(90deg, rgba(0,0,0,.72) 0%, rgba(0,0,0,.40) 44%, rgba(0,0,0,.10) 75%, rgba(0,0,0,.05) 100%);
      z-index:1;
    }
    .heroSlide .heroImg{
      position:absolute; right:0; top:0; bottom:0;
      width:52%;
      display:flex;
      align-items:flex-end;
      justify-content:flex-end;
      padding:10px 14px;
      z-index:0;
      pointer-events:none;
    }
    .heroSlide img{
      max-height:92%;
      width:auto;
      object-fit:contain;
      object-position: 50% 15%;
filter: drop-shadow(0 14px 24px rgba(0,0,0,.35));
      opacity:.98;
    }
    /* Mobile: image takes less space */
    @media (max-width: 720px){
      .hero{ grid-column:1 / -1;
       height:160px; margin:10px; }
      .heroSlide .heroImg{ width:58%; }
      .heroSlide img{ max-height:92%; }
    }
    .heroOverlay{
      position:absolute; inset:0;
      z-index:3;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:6px;
      padding:18px 16px;
    }
    .heroKicker{
      letter-spacing:.18em;
      font-size:11px;
      font-weight:900;
      color:rgba(234,240,255,.85);
      text-transform:uppercase;
    }
    .heroTitle{
      font-size:22px;
      font-weight:900;
      line-height:1.05;
      text-transform:uppercase;
      text-shadow: 0 10px 20px rgba(0,0,0,.55);
    }
    .compact .heroTitle{ font-size:18px; }
    .heroSub{
      font-size:12px;
      color:rgba(234,240,255,.82);
      max-width: 430px;
    }
    .heroFX{ position:absolute; inset:0; z-index:2; pointer-events:none; }
    .heroSmoke{
      position:absolute; inset:-40px;
      background:
        radial-gradient(380px 220px at 18% 62%, rgba(255,255,255,.12), transparent 62%),
        radial-gradient(520px 260px at 58% 78%, rgba(255,255,255,.08), transparent 65%),
        radial-gradient(520px 260px at 88% 35%, rgba(255,255,255,.07), transparent 70%);
      filter: blur(18px);
      opacity:.55;
      animation: smokeFloat 10s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    @keyframes smokeFloat{
      0%,100%{ transform: translate3d(0,0,0) scale(1.02); }
      50%{ transform: translate3d(-8px, -6px, 0) scale(1.04); }
    }
    .heroGlow{
      position:absolute; inset:0;
      background:
        radial-gradient(520px 260px at 65% 25%, rgba(255,215,64,.12), transparent 62%),
        radial-gradient(720px 280px at 25% 20%, rgba(31,111,235,.18), transparent 60%);
      opacity:.9;
      mix-blend-mode: screen;
    }
    .heroSweep{
      position:absolute; top:-30%; left:-30%;
      width:60%; height:160%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
      transform: rotate(18deg);
      animation: sweep 5.8s linear infinite;
      opacity:.55;
    }
    @keyframes sweep{
      0%{ transform: translateX(-50%) rotate(18deg); }
      100%{ transform: translateX(220%) rotate(18deg); }
    }
    .heroDots{
      position:absolute; left:14px; bottom:12px;
      z-index:4;
      display:flex; gap:6px;
      opacity:.92;
    }
    .heroDot{
      width:7px; height:7px; border-radius:999px;
      background: rgba(234,240,255,.35);
      border:1px solid rgba(255,255,255,.20);
    }
    .heroDot.active{
      background: rgba(234,240,255,.90);
    }

    .banner{
      padding:10px 14px;
      border-bottom:1px dashed rgba(255,255,255,.16);
      color:var(--warn);
      font-size:12px;
      display:none;
    }
    .banner.show{display:block;}

    #chat{
      padding:14px;
      height:100%;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .bubble{
      max-width:78%;
      padding:10px 12px;
      border-radius:14px;
      line-height:1.35;
      white-space:pre-wrap;
      word-wrap:break-word;
      border:1px solid rgba(255,255,255,.10);
    }
    .user{
      align-self:flex-end;
      background: rgba(31,111,235,.22);
      border-color: rgba(31,111,235,.35);
    }
    .bot{
      align-self:flex-start;
      background: rgba(0,0,0,.18);
    }

    .composer{
      display:flex;
      gap:10px;
      padding:12px 14px;
      border-top:1px solid var(--line);
      background: rgba(0,0,0,.12);
      align-items:center;
    }
    textarea{
      flex:1;
      resize:none;
      height:44px;
      max-height:130px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color:var(--text);
      padding:10px 12px;
      font-size:13px;
      outline:none;
    }
    button{
    background: var(--accent);
    border:none;
    padding:10px 14px;
    border-radius:12px;
    font-size:14px;
    font-weight:800;
    color:#fff;
    cursor:pointer;
    min-width:92px;
  }
  button.secondary{
    background: rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.18);
    color: var(--text);
    min-width:88px;
  }
  button.secondary:hover{background: rgba(255,255,255,.14);} 

  button{
      background: var(--accent);
      border:none;
      padding:10px 14px;
      border-radius:12px;
      font-size:14px;
      font-weight:800;
      color:#fff;
      cursor:pointer;
      min-width:92px;
    }
    button:disabled{opacity:.6; cursor:not-allowed;}

    .sidepad{padding:12px 14px;}
    .countdown{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 14px;
      border-bottom:1px solid var(--line);
    }
    .countdown .label{font-size:12px; color:var(--muted); font-weight:700;}
    .countdown .nums{
      display:flex;
      gap:10px;
      align-items:baseline;
      font-weight:900;
      font-size:13px;
      white-space:nowrap;
    }
    .nums span{color:var(--text);}
    .nums b{color:#f5d76e;}

    .schedule{flex:1; min-height:0; overflow:auto; padding-bottom:78px;}
    .match{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-top:1px solid rgba(255,255,255,.10);
      font-size:12px;
    }
    .match .left{display:flex; flex-direction:column; gap:2px;}
    .match .when{color:var(--muted);}
    .match.next{
      background: rgba(46,160,67,.18);
      border-top:1px solid rgba(46,160,67,.35);
    }

    .matchday{
      margin:12px 14px 0;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(245,215,110,.35);
      background: rgba(245,215,110,.10);
      font-size:12px;
      display:none;
    }
    .matchday.show{display:block;}

    .menuitem{
      padding:7px 7px;
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      background: linear-gradient(135deg, rgba(31,111,235,.16) 0%, rgba(0,0,0,.18) 55%, rgba(46,160,67,.10) 100%);
      position:relative;
      overflow:hidden;
    }
    .menuitem:before{
      content:"";
      position:absolute;
      inset:-1px;
      background: radial-gradient(220px 90px at 15% 10%, rgba(245,215,110,.18) 0%, rgba(0,0,0,0) 60%);
      pointer-events:none;
    }
    .menuitem .name{font-weight:900; font-size:11px; letter-spacing:.15px;}
    .menuitem .desc{color:var(--muted); margin-top:3px; font-size:9px; line-height:1.25;}
    .menuitem .price{margin-top:6px; font-weight:900; color:#f5d76e; font-size:10px;}
    .menuTop{display:flex; align-items:flex-start; justify-content:space-between; gap:10px;}
    .menuBadge{
      border:1px solid rgba(245,215,110,.35);
      background: rgba(245,215,110,.10);
      padding:4px 8px;
      border-radius:999px;
      font-size:11px;
      color:#f5d76e;
      white-space:nowrap;
    }
    .menuMeta{margin-top:6px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    .menuTag{
      font-size:11px;
      color:var(--muted);
      border:1px solid rgba(255,255,255,.12);
      padding:3px 8px;
      border-radius:999px;
      background:rgba(0,0,0,.10);
    }

    .hint{
      padding:10px 14px;
      font-size:12px;
      color:var(--muted);
      border-top:1px dashed rgba(255,255,255,.14);
    }
    code{background:rgba(255,255,255,.10); padding:2px 6px; border-radius:8px;}
  
    /* Compact WC menu (small + sleek) */
    .menucard{max-height:460px;}
    .menu{max-height:390px;}
    @media (max-width: 950px){
      .menucard{max-height:none;}
      .menu{max-height:none;}
    }


    /* Slightly tighter sidebar so it stays compact */
    .countdown{padding:10px 12px;}
    .match{padding:9px 10px;}


    /* Layout override: compact menu + wide chat (desktop) */
    .leftcol{
      display:grid;
      grid-template-columns: 170px 1fr; /* Menu | Chat */
      gap:14px;
      min-height:0;
      height:100%;
      align-items:stretch;
    }
    .chatcard{display:flex; flex-direction:column; min-height:0;}
    .menucard{display:flex; flex-direction:column; min-height:0; max-width:190px; max-height:460px;}
    @media (max-width: 950px){
      .leftcol{grid-template-columns: 1fr;}
      .menucard{max-width:none; max-height:none;}
    }


    /* --- Chat readability upgrades (requested) --- */
    #chat{gap:8px;} /* tighter vertical spacing */
    .bubble{
      padding:8px 10px;           /* tighter bubble padding */
      line-height:1.28;           /* tighter line-height */
      font-size:13px;             /* base (user) */
    }
    .bot{font-size:12px;}         /* slightly smaller bot text */
    .user{font-size:13px;}        /* slightly larger user text */

    /* “Stadium announcer” emphasis for match alerts */
    .banner.show,
    .matchday.show{
      text-transform:uppercase;
      letter-spacing:.7px;
      font-weight:900;
    }
    .banner.show{
      background: linear-gradient(90deg, rgba(245,215,110,.18) 0%, rgba(46,160,67,.10) 40%, rgba(31,111,235,.10) 100%);
      border-bottom: 1px solid rgba(245,215,110,.35);
      text-shadow: 0 2px 18px rgba(0,0,0,.35);
    }
    @keyframes announcerPulse{
      0%{transform:translateY(0); filter:brightness(1);}
      50%{transform:translateY(-1px); filter:brightness(1.08);}
      100%{transform:translateY(0); filter:brightness(1);}
    }
    .banner.show{animation: announcerPulse 1.6s ease-in-out infinite;}

    /* Compact mode (power users) */
    .compact #chat{gap:6px;}
    .compact .bubble{padding:7px 9px; line-height:1.22;}
    .compact .user{font-size:12.5px;}
    .compact .bot{font-size:11.5px;}
    .compact textarea{height:40px; font-size:13px; padding:9px 11px;}
    .compact .composer{padding:10px 12px;}
    .compact .match{padding:8px 9px; font-size:11px;}
    .compact .pill{padding:5px 9px; font-size:10.5px;}
    .compact .cardhead{padding:10px 12px;}
    .compact .menu{font-size:8.5px;}


    /* Keep pagination controls visible (fix: pager off-screen in regular mode) */
    #pager{
      position: sticky;
      bottom: 0;
      z-index: 6;
      background: rgba(7,16,34,.92);
      backdrop-filter: blur(8px);
      border-top: 1px solid rgba(255,255,255,.12);
      margin-top: auto;
    }


/* ===== HERO UPGRADE: stadium + crowd glow + action marquee (UI-only) ===== */
.hero{ background: linear-gradient(135deg, rgba(31,111,235,.18), rgba(46,160,67,.10)); }
.hero::before{
  content:"";
  position:absolute; inset:-12px;
  background-image: url("https://commons.wikimedia.org/wiki/Special:FilePath/Snapdragon%20Stadium%20interior-Night%20panorama%20view%202.jpg?width=2000");
  background-size: cover;
  background-position: center;
  opacity: .38;
  filter: saturate(1.22) contrast(1.10);
  transform: scale(1.06);
  z-index:0;
}
.hero::after{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(520px 260px at 20% 30%, rgba(255,255,255,.22), transparent 60%),
    radial-gradient(680px 320px at 70% 18%, rgba(255,255,255,.18), transparent 62%),
    radial-gradient(900px 420px at 55% 85%, rgba(46,160,67,.14), transparent 65%),
    radial-gradient(900px 420px at 35% 88%, rgba(31,111,235,.16), transparent 66%);
  mix-blend-mode: screen;
  opacity: .75;
  animation: crowdPulse 4.6s ease-in-out infinite;
  z-index:1;
  pointer-events:none;
}
@keyframes crowdPulse{
  0%,100%{ filter: blur(0px); opacity:.70; }
  50%{ filter: blur(1.2px); opacity:.85; }
}
.heroFX{ z-index:3; }
.heroSmoke{
  opacity:.95;
  filter: blur(16px);
  animation: smokeFloat 9s ease-in-out infinite;
}
@keyframes smokeFloat{
  0%,100%{ transform: translate3d(0,0,0) scale(1); opacity:.85; }
  50%{ transform: translate3d(-10px,-8px,0) scale(1.03); opacity:1; }
}
.heroGlow{
  position:absolute; inset:-60px;
  background:
    radial-gradient(520px 260px at 15% 55%, rgba(255,255,255,.22), transparent 62%),
    radial-gradient(760px 360px at 60% 70%, rgba(255,255,255,.15), transparent 68%),
    radial-gradient(900px 420px at 80% 35%, rgba(255,255,255,.13), transparent 72%);
  filter: blur(14px);
  opacity: .85;
}
.heroSweep{
  opacity:.85;
  filter: blur(0px);
}

.heroSlides{
  position:absolute; inset:0;
  z-index:2;
  pointer-events:none;
  overflow:hidden;
}

.heroMarquee{
  position:absolute;
  left:0; right:0;
  display:flex;
  gap:12px;
  align-items:flex-end;
  padding:0 18px 12px 18px;
  will-change: transform;
}
.heroMarqueeA{ bottom:8px; animation: heroMarquee 26s linear infinite; }
.heroMarqueeB{ bottom:58px; opacity:.88; transform: translateY(0) scale(.92); animation: heroMarquee 34s linear infinite reverse; }
@keyframes heroMarquee{
  0%{ transform: translateX(0); }
  100%{ transform: translateX(-50%); }
}

.heroCard{
  width:150px;
  height:96px;
  border-radius:14px;
  overflow:hidden;
  background: rgba(6,12,26,.55);
  border: 1px solid rgba(255,255,255,.14);
  box-shadow: 0 16px 30px rgba(0,0,0,.25);
  position:relative;
}
.compact .heroCard{ width:120px; height:78px; border-radius:12px; }
.heroCard::before{
  content:"";
  position:absolute; inset:0;
  background: radial-gradient(240px 120px at 15% 25%, color-mix(in srgb, var(--c) 65%, transparent), transparent 62%);
  opacity:.85;
  pointer-events:none;
}
.heroCardImg{ position:absolute; inset:0; }
.heroCardImg img{
  width:100%; height:100%;
  object-fit: cover;
  object-position: 50% 18%;
  filter: saturate(1.15) contrast(1.06);
  transform: scale(1.02);
}
.heroCardMeta{
  position:absolute; left:10px; right:10px; bottom:8px;
  display:flex; flex-direction:column; gap:2px;
  z-index:2;
  text-shadow: 0 10px 18px rgba(0,0,0,.55);
}
.heroCardName{ font-weight:900; font-size:12px; line-height:1.05; }
.heroCardCountry{ font-size:10px; opacity:.90; }
.heroCardMeta::after{
  content:"";
  position:absolute; inset:-8px -10px;
  background: linear-gradient(to top, rgba(0,0,0,.70), rgba(0,0,0,.18), transparent);
  z-index:-1;
}

.heroRoster{
  margin-top:10px;
  overflow:hidden;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.18);
}
.heroRosterTrack{
  display:inline-flex;
  gap:8px;
  padding:6px 10px;
  white-space:nowrap;
  animation: rosterScroll 18s linear infinite;
}
@keyframes rosterScroll{
  0%{ transform: translateX(0); }
  100%{ transform: translateX(-50%); }
}
.heroChip{
  display:inline-flex;
  align-items:center;
  padding:4px 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:800;
  letter-spacing:.01em;
  background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.10);
}
/* ===== END HERO UPGRADE ===== */


/* =========================
   HERO (3-up fade rotation)
   ========================= */
.heroTriWrap{
  position:absolute;
  top:14px; bottom:14px;
  right:14px;
  width:min(460px, 48%);
  z-index:4;
  pointer-events:none; /* never blocks chat/menu/schedule */
  display:flex;
  align-items:flex-end;
  justify-content:flex-end;
}
.compact .heroTriWrap{ width:min(380px, 56%); right:10px; top:10px; bottom:10px; }

#heroSlides{
  width:100%;
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:12px;
  align-items:end;
  opacity:1;
  transform: translateY(0);
  transition: opacity 420ms ease, transform 420ms ease;
}
#heroSlides.isFading{
  opacity:0;
  transform: translateY(6px);
}

.heroCard.heroCardTri{
  width:auto;
  height:110px;
  border-radius:16px;
  overflow:hidden;
  background: rgba(6,12,26,.52);
  border:1px solid rgba(255,255,255,.14);
  box-shadow: 0 16px 30px rgba(0,0,0,.25);
  position:relative;
}
.compact .heroCard.heroCardTri{ height:92px; border-radius:14px; }

.heroCard.heroCardTri .heroCardImg img{
  width:100%; height:100%;
  object-fit: cover;
  object-position: 50% 18%;
  filter: saturate(1.18) contrast(1.10);
  transform: scale(1.04);
}

/* Keep names under each card (already in markup) */
.heroCard.heroCardTri .heroCardMeta{ left:10px; right:10px; bottom:8px; }

/* Make sure headline stays readable even over bright stadium */
.heroTitle, .heroSub{
  text-shadow: 0 10px 26px rgba(0,0,0,.80);
}


/* ===== HERO BANNER UPGRADE (single-player cinematic) ===== */
:root{
  --gold:#f6d365;
  --gold2:#fda085;
}
.heroTitle{ color: var(--gold); text-shadow: 0 10px 24px rgba(0,0,0,.55), 0 0 22px rgba(246,211,101,.18); }
.heroKicker{ color: rgba(255,255,255,.86); }

#heroSlides{
  position:absolute;
  inset:0;
  display:block;
  position:relative;
  width:100%;
  height:100%;
  transition: opacity .48s ease, transform .48s ease;
}
#heroSlides.isFading{ opacity:0; transform: scale(.995); }

.heroCard.isSingle{
  position:absolute;
  inset:0;
  border-radius:18px;
  overflow:hidden;
  background: rgba(0,0,0,.25);
}

/* blurred background fill (so landscape images still look premium) */
.heroBg{
  position:absolute;
  inset:-18%;
  background-size:cover;
  background-position:center;
  filter: blur(18px) saturate(1.15) brightness(.78);
  transform: scale(1.08);
  opacity:.9;
}
.heroCard.isSingle::after{
  content:"";
  position:absolute;
  inset:0;
  background: radial-gradient(700px 380px at 50% 45%, rgba(255,255,255,.08), rgba(0,0,0,.42) 60%, rgba(0,0,0,.60) 100%);
  pointer-events:none;
}

/* main player image (centered, visible, cinematic) */
.heroImg{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-46%);
  max-width: 82%;
  max-height: 92%;
  width:auto;
  height:auto;
  object-fit: contain;
  filter: drop-shadow(0 18px 30px rgba(0,0,0,.55));
  opacity:1;
}

/* subtle zoom that pairs with crossfade */
.heroImg.kenBurns{
  animation: heroKenBurns 5s ease-in-out forwards;
}
@keyframes heroKenBurns{
  from{ transform: translate(-50%,-46%) scale(1.02); }
  to  { transform: translate(-50%,-46%) scale(1.08); }
}

/* country glow */
.heroGlow{
  position:absolute;
  inset:-20%;
  background: radial-gradient(460px 340px at 50% 55%, color-mix(in srgb, var(--glow) 58%, transparent), transparent 70%);
  opacity:.9;
  mix-blend-mode: screen;
  pointer-events:none;
}

/* nameplate (kept low to avoid headers) */
.heroMeta{
  position:absolute;
  left:50%;
  bottom:16px;
  transform: translateX(-50%);
  text-align:center;
  padding:10px 14px;
  border-radius:999px;
  background: rgba(0,0,0,.35);
  border: 1px solid rgba(255,255,255,.12);
  backdrop-filter: blur(10px);
  pointer-events:none;
}
.heroMetaName{
  font-weight: 800;
  letter-spacing: .3px;
  color: #fff;
  font-size: 14px;
}
.heroMetaCountry{
  font-size: 12px;
  color: rgba(255,255,255,.8);
  margin-top:2px;
}

/* If an image fails to load, keep the background + glow (no blank banner). */
.heroCard.imgFail .heroBg{ opacity: .65; }
.heroCard.imgFail .heroGlow{ opacity: .7; }

/* light sweep: ensure the sweep stays visible on top */
.heroSweep{ opacity: .55; }

</style>
</head>
<body>
<div class="wrap">
<header>
<div class="toprow">
<div class="brand">
<div aria-hidden="true" class="badge"></div>
<div>
<h1>World Cup 2026 • Dallas Match-Day Concierge</h1>
<div class="sub">Reserve tables, see Dallas match schedule, and chat in English • Español • Português • Français</div>
</div>
</div>
<div aria-label="Language toggle" class="langbar">
<div class="langbtn active" data-lang="en">English</div>
<div class="langbtn" data-lang="es">Español</div>
<div class="langbtn" data-lang="pt">Português</div>
<div class="langbtn" data-lang="fr">Français</div>
</div>
</div>
</header>
<div class="grid"><div aria-label="World Cup 2026 hero banner" class="hero" id="heroBanner">
<div aria-hidden="true" class="heroSlides" id="heroSlides"></div>
<div aria-hidden="true" class="heroFX">
<div class="heroSmoke"></div>
<div class="heroGlow"></div>
<div class="heroSweep"></div>
</div>
<div class="heroOverlay">
<div class="heroKicker">WORLD CUP 2026</div>
<div class="heroTitle">DALLAS MATCH DAY HQ</div>
<div class="heroSub">Reserve tables • Live schedules • Concierge chat</div>
<div class="heroRoster" id="heroRoster" aria-hidden="true"></div>
</div>
<div aria-hidden="true" class="heroDots" id="heroDots"></div>
</div>
<!-- Left column: Menu (left) + Chat/Reservations (right) -->
<div class="leftcol">
<!-- Menu -->
<div class="card menucard" style="display:flex;flex-direction:column;min-height:0; max-width:190px;">
<div class="cardhead">
<div class="title" id="menuTitle">Menu</div>
<div class="pill" id="menuPill">4 languages</div>
</div>
<div class="menu" id="menu"></div>
</div>
<!-- Chat / Reservations -->
<div class="card chatcard" style="display:flex;flex-direction:column;min-height:0;">
<div class="cardhead">
<div class="title" id="chatTitle">Chat</div>
<div style="display:flex; gap:8px; align-items:center;">
<div class="pill" id="pillMode">Live</div>
<button class="secondary" id="compactToggle" style="min-width:auto; padding:6px 10px; border-radius:999px; font-size:12px; font-weight:800;">Compact</button>
</div>
</div>
<!-- HERO: Cinematic rotating banner (UI-only; no backend impact) -->

<div class="banner" id="matchBanner"></div>
<div id="chat"></div>
<div class="composer">
<textarea id="msg" placeholder="Type here..."></textarea>
<button id="sendBtn">Send</button>
<button class="secondary" id="clearBtn">Clear</button>
</div>
<div class="hint" id="helperHint"></div>
</div>
</div>
<!-- Sidebar -->
<div class="card" style="display:flex;flex-direction:column;min-height:0;">
<div class="cardhead">
<div class="title" id="sideTitle">Dallas Schedule</div>
<div class="pill" id="pillLang">EN</div>
</div>
<div class="countdown">
<div>
<div class="label" id="countLabel">World Cup countdown</div>
<div class="sub" id="countSub" style="margin:4px 0 0;">Dallas / Arlington match days</div>
</div>
<div class="nums" id="countNums">
<span><b id="d">0</b>d</span>
<span><b id="h">0</b>h</span>
<span><b id="m">0</b>m</span>
<span><b id="s">0</b>s</span>
</div>
</div>
<div class="matchday" id="matchdayBox"></div>
<div class="sidepad" style="padding-top:10px; padding-bottom:0;">
<div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
<div class="pill" style="padding:6px 10px;">Schedule</div>
<div class="langbar" style="gap:6px;">
<div class="langbtn active" id="scopeDallas">Dallas</div>
<div class="langbtn" id="scopeAll">All Matches</div>
</div>
</div>
<div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
<input id="teamSearch" placeholder="Search team / venue / date (e.g., June 13 or 2026-06-13)..." style="flex:1; height:40px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background: rgba(0,0,0,.22); color:var(--text); padding:0 12px; font-size:13px; outline:none;"/>
<div class="pill" id="matchCount">0</div>
</div>
</div>
<div class="sidepad" style="padding-bottom:0;">
<div class="pill" id="nextHint" style="display:inline-block;">Next upcoming match is highlighted</div>
</div>
<div class="schedule" id="schedule"></div>
<div class="sidepad" id="pager" style="display:none; padding-top:10px;">
<div style="display:flex; gap:10px; align-items:center; justify-content:space-between;">
<button class="secondary" id="prevPage" style="min-width:88px;">Prev</button>
<div class="pill" id="pageIndicator">Page 1 of 1</div>
<button class="secondary" id="nextPage" style="min-width:88px;">Next</button>
</div>
</div>
</div>
</div>
</div>
<script>
/**
 * This frontend matches your current app.py endpoints:
 *  - GET /schedule.json
 *  - GET /menu.json?lang=en|es|pt|fr
 *  - POST /chat { message, session_id, language }
 *
 * Keeps all original features: language toggle, chat, helper hint,
 * countdown, schedule highlight, match-day banner.
 */

// -----------------------
// Session + state
// -----------------------
const sessionId = (localStorage.getItem("session_id") || (() => {
  const id = "sess_" + Math.random().toString(16).slice(2) + "_" + Date.now();
  localStorage.setItem("session_id", id);
  return id;
})());

let lang = localStorage.getItem("lang") || "en";
let scheduleData = null;
let scope = localStorage.getItem("schedule_scope") || "dallas";
let scheduleQuery = "";

// Pagination (Dallas + All Matches)
const PAGE_SIZE = 5;
let currentPage = 1;


let menuData = null;
let menuPage = 1; // safe default (menu is non-paginated)


// Conversation memory (client-side history) — kept as a feature
const history = [];

const chatEl = document.getElementById("chat");
const msgEl = document.getElementById("msg");
const sendBtn = document.getElementById("sendBtn");
const helperHint = document.getElementById("helperHint");
const pillLang = document.getElementById("pillLang");
const pillMode = document.getElementById("pillMode");
const heroBanner = document.getElementById("heroBanner");
const heroSlidesEl = document.getElementById("heroSlides");
const heroDotsEl = document.getElementById("heroDots");
const matchBanner = document.getElementById("matchBanner");
const matchdayBox = document.getElementById("matchdayBox");

const clearBtn = document.getElementById("clearBtn");
const scopeDallasBtn = document.getElementById("scopeDallas");
const scopeAllBtn = document.getElementById("scopeAll");
const teamSearchEl = document.getElementById("teamSearch");
const matchCountEl = document.getElementById("matchCount");
const pagerEl = document.getElementById("pager");
const prevPageBtn = document.getElementById("prevPage");
const nextPageBtn = document.getElementById("nextPage");
const pageIndicatorEl = document.getElementById("pageIndicator");





// -----------------------
// Compact mode (power users)
// -----------------------
let compactMode = (localStorage.getItem("compact_mode") || "0") === "1";
const compactToggleBtn = document.getElementById("compactToggle");

function applyCompactMode(){
  document.body.classList.toggle("compact", compactMode);
  if (compactToggleBtn){
    compactToggleBtn.textContent = compactMode ? "Compact: ON" : "Compact";
    compactToggleBtn.classList.toggle("active", compactMode);
  }
}

if (compactToggleBtn){
  compactToggleBtn.addEventListener("click", () => {
    compactMode = !compactMode;
    localStorage.setItem("compact_mode", compactMode ? "1" : "0");
    applyCompactMode();
  });
}

const STRINGS = {
  en: {
    welcome: "⚽ Welcome, World Cup fan! I’m your Dallas Match-Day Concierge.\nType \"reservation\" to book a table, or ask about Dallas matches, all matches, or the menu.",
    lang_set: "Language set to English.",
    helper: 'Try: <code>reservation</code> to book • <code>Recall reservation so far</code> • Ask about the menu • Ask about Dallas match days. Search by team, venue, or date (e.g., "June 13").',
    send: "Send",
    typing: "...",
    chat_title: "Chat",
    side_title: "Dallas Schedule",
    countdown: "World Cup countdown",
    countdown_sub: "Dallas / Arlington match days",
    next_hint: "Next upcoming match is highlighted",
    schedule_empty: "Schedule coming soon — update the match list in <code>app.py</code> (DALLAS_MATCHES).",
    menu_title: "Menu"
  },
  es: {
    welcome: "⚽ ¡Bienvenido, fan del Mundial! Soy tu concierge de días de partido en Dallas.\nEscribe \"reserva\" para reservar una mesa, o pregunta por los partidos (Dallas / todos) o el menú.",
    lang_set: "Idioma cambiado a Español.",
    helper: 'Prueba: <code>reserva</code> para reservar • <code>Recordar reserva</code> • Pregunta por el menú • Pregunta por los partidos en Dallas.',
    send: "Enviar",
    typing: "...",
    chat_title: "Chat",
    side_title: "Horario Dallas + Menú",
    countdown: "Cuenta regresiva",
    countdown_sub: "Días de partido Dallas / Arlington",
    next_hint: "El próximo partido está resaltado",
    schedule_empty: "El calendario estará disponible pronto — actualiza <code>DALLAS_MATCHES</code> en <code>app.py</code>.",
    menu_title: "Menú"
  },
  pt: {
    welcome: "⚽ Bem-vindo, fã da Copa do Mundo! Sou seu concierge de dias de jogo em Dallas.\nDigite \"reserva\" para reservar uma mesa, ou pergunte sobre jogos em Dallas, todos os jogos ou o cardápio.",
    lang_set: "Idioma definido para Português.",
    helper: 'Tente: <code>reserva</code> para reservar • <code>Relembrar reserva</code> • Pergunte sobre o cardápio • Pergunte sobre jogos em Dallas.',
    send: "Enviar",
    typing: "...",
    chat_title: "Chat",
    side_title: "Agenda Dallas + Cardápio",
    countdown: "Contagem regressiva",
    countdown_sub: "Dias de jogo Dallas / Arlington",
    next_hint: "O próximo jogo está destacado",
    schedule_empty: "Agenda em breve — atualize <code>DALLAS_MATCHES</code> no <code>app.py</code>.",
    menu_title: "Cardápio"
  },
  fr: {
    welcome: "⚽ Bienvenue, fan de la Coupe du Monde ! Je suis votre concierge des jours de match à Dallas.\nTapez \"réservation\" pour réserver une table, ou demandez les matchs (Dallas / tous) ou le menu.",
    lang_set: "Langue définie sur Français.",
    helper: 'Essayez : <code>réservation</code> pour réserver • <code>Rappeler la réservation</code> • Demandez le menu • Demandez les matchs à Dallas.',
    send: "Envoyer",
    typing: "...",
    chat_title: "Chat",
    side_title: "Programme Dallas + Menu",
    countdown: "Compte à rebours",
    countdown_sub: "Jours de match Dallas / Arlington",
    next_hint: "Le prochain match est surligné",
    schedule_empty: "Programme bientôt disponible — mettez à jour <code>DALLAS_MATCHES</code> dans <code>app.py</code>.",
    menu_title: "Menu"
  }
};

function L(){ return STRINGS[lang] || STRINGS.en; }

function addBubble(role, text){
  const b = document.createElement("div");
  b.className = "bubble " + (role === "user" ? "user" : "bot");
  b.textContent = text;
  chatEl.appendChild(b);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function setSending(isSending){
  sendBtn.disabled = isSending;
  msgEl.disabled = isSending;
  sendBtn.textContent = isSending ? L().typing : L().send;
}

// -----------------------
// Language toggle
// -----------------------
function applyLanguageToUI(){
  pillLang.textContent = lang.toUpperCase();
        // apply schedule scope UI
        document.getElementById("scopeDallas")?.classList.toggle("active", scope === "dallas");
        document.getElementById("scopeAll")?.classList.toggle("active", scope === "all");
  document.querySelectorAll(".langbtn[data-lang]").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });

  // Titles + helper
  document.getElementById("chatTitle").textContent = L().chat_title;
  document.getElementById("sideTitle").textContent = L().side_title;
  document.getElementById("countLabel").textContent = L().countdown;
  document.getElementById("countSub").textContent = L().countdown_sub;
  document.getElementById("nextHint").textContent = L().next_hint;
  document.getElementById("menuTitle").textContent = L().menu_title;

  helperHint.innerHTML = L().helper;
  sendBtn.textContent = L().send;
  applyCompactMode();
}

async function setLanguage(newLang){
  lang = newLang;
  localStorage.setItem("lang", lang);
  applyLanguageToUI();
applyCompactMode();

  // reload menu in the chosen language
  await loadMenu();

  // show a bot notice (feature preserved)
  addBubble("assistant", L().lang_set + "\n\n" + stripHtml(L().helper));
  history.push({role:"assistant", content: L().lang_set});
}

document.querySelectorAll(".langbtn[data-lang]").forEach(btn => {
  btn.addEventListener("click", () => setLanguage(btn.dataset.lang));
});

// helper: render helper text in bubble without html tags
function stripHtml(html){
  const tmp = document.createElement("div");
  tmp.innerHTML = html;
  return tmp.textContent || tmp.innerText || "";
}


// -----------------------
// HERO banner (UI-only)
// -----------------------
const HERO_SLIDE_MS = 5000; // 5 seconds per player
const HERO_GROUP_SIZE = 1;  // one at a time (required)
let _heroTimer = null;
let _heroIndex = 0;
let _heroPaused = false;

// High-quality, license-friendly images (Wikimedia upload URLs). Swap with your own hosted images anytime.
const heroPlayers = [
  { name:"Lionel Messi",      country:"Argentina",    color:"#75AADB", img:"https://upload.wikimedia.org/wikipedia/commons/6/6c/Lionel_Messi_in_2018.jpg", pos:"50% 22%" },
  { name:"Cristiano Ronaldo", country:"Portugal",     color:"#006A4E", img:"https://upload.wikimedia.org/wikipedia/commons/9/9a/Cristiano_Ronaldo_Portugal.jpg", pos:"50% 18%" },
  { name:"Kylian Mbappé",     country:"France",       color:"#0055A4", img:"https://upload.wikimedia.org/wikipedia/commons/6/61/Kylian_Mbapp%C3%A9_World_Cup_Trophy.jpg", pos:"45% 18%" },
  { name:"Erling Haaland",    country:"Norway",       color:"#BA0C2F", img:"https://upload.wikimedia.org/wikipedia/commons/7/71/Erling_Haaland_June_2025.jpg", pos:"50% 16%" },
  { name:"Lamine Yamal",      country:"Spain",        color:"#C60B1E", img:"https://upload.wikimedia.org/wikipedia/commons/2/2c/Lamine_Yamal_in_2025_%28cropped%29.jpg", pos:"50% 20%" },
  { name:"Bukayo Saka",       country:"England",      color:"#CF142B", img:"https://upload.wikimedia.org/wikipedia/commons/1/14/2022_FIFA_World_Cup_England_0-0_USA_-_Saka_vs_Pulisic.jpg", pos:"50% 55%" },
  { name:"Vinícius Júnior",   country:"Brazil",       color:"#009C3B", img:"https://upload.wikimedia.org/wikipedia/commons/f/f3/Vinicius_Jr_2021.jpg", pos:"50% 18%" },
  { name:"Alphonso Davies",   country:"Canada",       color:"#D80621", img:"https://upload.wikimedia.org/wikipedia/commons/5/5e/Alphonso_Davies_2018.jpg", pos:"50% 30%" },
  { name:"Son Heung-min",     country:"South Korea",  color:"#003478", img:"https://upload.wikimedia.org/wikipedia/commons/archive/d/df/20180919042751%21Mex-Kor_%2819%29_%28cropped%29.jpg", pos:"50% 28%" }
];

const heroRosterNames = heroPlayers.map(p => p.name);

function renderHero(){
  const tri = document.getElementById("heroSlides");
  const heroBanner = document.getElementById("heroBanner");
  const heroDotsEl = document.getElementById("heroDots");
  const rosterEl = document.getElementById("heroRoster");

  if (!tri || !heroBanner) return;

  // Roster list (UI-only)
  if (rosterEl){
    rosterEl.innerHTML = heroRosterNames.map(n => `<span>${escapeHtml(n)}</span>`).join("");
  }
  if (heroDotsEl) heroDotsEl.innerHTML = "";

  // Pause on hover/touch (UI-only)
  heroBanner.addEventListener("mouseenter", () => { _heroPaused = true; });
  heroBanner.addEventListener("mouseleave", () => { _heroPaused = false; });
  heroBanner.addEventListener("touchstart", () => { _heroPaused = true; }, {passive:true});
  heroBanner.addEventListener("touchend", () => { _heroPaused = false; }, {passive:true});

  // Start at 0
  _heroIndex = 0;
  renderHeroGroup(_heroIndex, true);
  startHero();
}

function renderHeroGroup(startIdx, immediate=false){
  const tri = document.getElementById("heroSlides");
  if (!tri) return;

  const n = heroPlayers.length;
  if (!n) return;

  const i = ((startIdx % n) + n) % n;
  const p = heroPlayers[i] || {};
  const safeName = escapeHtml(p.name || "");
  const safeCountry = escapeHtml(p.country || "");
  const color = p.color || "#1f6feb";
  const pos = p.pos || "50% 20%";
  const img = p.img || "";

  const cardHTML = `
    <div class="heroCard isSingle" style="--glow:${color}">
      <div class="heroBg" style="background-image:url('${img.replace(/'/g, "%27")}')"></div>
      <img class="heroImg" alt="${safeName}" src="${img}" style="object-position:${pos}" loading="eager" decoding="async" referrerpolicy="no-referrer"
        onerror="this.onerror=null; this.style.display='none'; this.parentElement.classList.add('imgFail');" />
      <div class="heroMeta">
        <div class="heroMetaName">${safeName}</div>
        <div class="heroMetaCountry">${safeCountry}</div>
      </div>
      <div class="heroGlow"></div>
    </div>
  `;

  const doSwap = () => { tri.innerHTML = cardHTML; };

  if (immediate){
    tri.classList.remove("isFading");
    doSwap();
    // retrigger ken-burns
    requestAnimationFrame(() => {
      const imgEl = tri.querySelector(".heroImg");
      if (imgEl){
        imgEl.classList.remove("kenBurns");
        void imgEl.offsetWidth; // reflow
        imgEl.classList.add("kenBurns");
      }
    });
    return;
  }

  // Fade out -> swap -> fade in
  tri.classList.add("isFading");
  setTimeout(() => {
    doSwap();
    // fade back in + restart zoom
    requestAnimationFrame(() => {
      tri.classList.remove("isFading");
      const imgEl = tri.querySelector(".heroImg");
      if (imgEl){
        imgEl.classList.remove("kenBurns");
        void imgEl.offsetWidth;
        imgEl.classList.add("kenBurns");
      }
    });
  }, 480);
}

function startHero(){
  stopHero();
  _heroTimer = setInterval(() => {
    if (_heroPaused) return;
    const n = heroPlayers.length;
    if (!n) return;
    _heroIndex = (_heroIndex + HERO_GROUP_SIZE) % n;
    renderHeroGroup(_heroIndex, false);
  }, HERO_SLIDE_MS);
}

function stopHero(){
  if (_heroTimer) clearInterval(_heroTimer);
  _heroTimer = null;
}

// -----------------------
// -----------------------
// Fetchers (match app.py)
// -----------------------
async function loadSchedule(){
  const res = await fetch(`/schedule.json?scope=${encodeURIComponent(scope)}&q=${encodeURIComponent(scheduleQuery)}`, {cache:"no-store"});
  scheduleData = await res.json();
  renderSchedule();
  updateMatchDayMode();
  restartCountdown(); // uses schedule info when available
}

async function loadMenu(){
  const res = await fetch("/menu.json?lang=" + encodeURIComponent(lang), {cache:"no-store"});
  const data = await res.json();
  // app.py returns { lang, menu: {title, items:[]}}
  menuData = data.menu;
  window.menuDataList = (menuData && Array.isArray(menuData.items)) ? menuData.items : [];
  menuPage = 1;
  renderMenu(window.menuDataList);
}

function safeParseTimestamp(dateIso, timeStr){
  // Supports:
  // - "19:00"
  // - "7:00 PM" / "7:00PM" / "7 PM"
  // - empty / "TBD" (falls back to end-of-day)
  if (!dateIso) return null;

  const raw = (timeStr || "").toString().trim();
  if (raw && raw.toUpperCase() !== "TBD"){
    // 24-hour "HH:MM"
    const m24 = raw.match(/^(\d{1,2}):(\d{2})$/);
    if (m24){
      const hh = m24[1].padStart(2,"0");
      const mm = m24[2];
      return Date.parse(`${dateIso}T${hh}:${mm}:00`);
    }

    // 12-hour "H(:MM)? AM/PM"
    const m12 = raw.match(/^(\d{1,2})(?::(\d{2}))?\s*([AaPp][Mm])$/);
    if (m12){
      let hh = parseInt(m12[1],10);
      const mm = (m12[2] || "00");
      const ap = m12[3].toUpperCase();
      if (ap === "PM" && hh !== 12) hh += 12;
      if (ap === "AM" && hh === 12) hh = 0;
      const hh2 = String(hh).padStart(2,"0");
      return Date.parse(`${dateIso}T${hh2}:${mm}:00`);
    }

    // 12-hour with no minutes: "7 PM"
    const m12b = raw.match(/^(\d{1,2})\s*([AaPp][Mm])$/);
    if (m12b){
      let hh = parseInt(m12b[1],10);
      const ap = m12b[2].toUpperCase();
      if (ap === "PM" && hh !== 12) hh += 12;
      if (ap === "AM" && hh === 12) hh = 0;
      const hh2 = String(hh).padStart(2,"0");
      return Date.parse(`${dateIso}T${hh2}:00:00`);
    }
  }

  // end-of-day fallback (still keeps countdown alive even if time missing)
  return Date.parse(`${dateIso}T23:59:59`);
}

// -----------------------
// Countdown
// -----------------------
let countdownTimer = null;

function chooseCountdownTarget(){
  // Prefer next match datetime if present; otherwise fixed World Cup-ish date.
  // If DALLAS_MATCHES is empty, still show a countdown.
  if (scheduleData && scheduleData.next_match && scheduleData.next_match.date){
    const nm = scheduleData.next_match;
    const ts = safeParseTimestamp(nm.date, nm.time);
    if (ts) return new Date(ts);
  }
  // fallback: World Cup June 2026 (safe constant, preserves feature)
  return new Date("2026-06-11T00:00:00");
}

function restartCountdown(){
  if (countdownTimer) clearInterval(countdownTimer);

  const target = chooseCountdownTarget();
  const dEl = document.getElementById("d");
  const hEl = document.getElementById("h");
  const mEl = document.getElementById("m");
  const sEl = document.getElementById("s");

  function tick(){
    const now = new Date();
    let diff = Math.max(0, target - now);

    const days = Math.floor(diff / (1000*60*60*24));
    diff -= days*(1000*60*60*24);
    const hrs = Math.floor(diff / (1000*60*60));
    diff -= hrs*(1000*60*60);
    const mins = Math.floor(diff / (1000*60));
    diff -= mins*(1000*60);
    const secs = Math.floor(diff / 1000);

    dEl.textContent = days;
    hEl.textContent = hrs;
    mEl.textContent = mins;
    sEl.textContent = secs;
  }

  tick();
  countdownTimer = setInterval(tick, 1000);
}

// -----------------------
// Schedule rendering + next match highlight
// -----------------------

function formatKickoffTime(t){
  const s = (t || "").toString().trim();
  if (!s || s.toUpperCase() === "TBD") return "TBD";
  // Already 12-hour?
  if (/[AP]M/i.test(s)) {
    // normalize spacing: "7:00 pm" -> "7:00 PM"
    return s.replace(/\s+/g," ").replace(/am/i,"AM").replace(/pm/i,"PM");
  }
  // "19:00" -> "7:00 PM"
  const m = s.match(/^(\d{1,2}):(\d{2})$/);
  if (m){
    let hh = parseInt(m[1],10);
    const mm = m[2];
    const ap = hh >= 12 ? "PM" : "AM";
    hh = hh % 12; if (hh === 0) hh = 12;
    return `${hh}:${mm} ${ap}`;
  }
  return s;
}

// Normalize schedule search so users can type a specific day like "June 13" and still match backend dates ("YYYY-MM-DD").
// Backend filters against m.date (ISO), so we convert common date inputs to ISO when possible.
function normalizeScheduleSearch(raw){
  const s = (raw || "").toString().trim();
  if (!s) return "";
  if (/^20\d{2}-\d{2}-\d{2}$/.test(s)) return s;

  const slash = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{2,4})$/);
  if (slash){
    let mm = parseInt(slash[1],10);
    let dd = parseInt(slash[2],10);
    let yy = parseInt(slash[3],10);
    if (yy < 100) yy += 2000;
    const m2 = String(mm).padStart(2,"0");
    const d2 = String(dd).padStart(2,"0");
    return `${yy}-${m2}-${d2}`;
  }

  const lower = s.toLowerCase();
  const monthMap = {
    january:1, jan:1, february:2, feb:2, march:3, mar:3, april:4, apr:4, may:5,
    june:6, jun:6, july:7, jul:7, august:8, aug:8, september:9, sep:9, sept:9,
    october:10, oct:10, november:11, nov:11, december:12, dec:12,
    // Spanish
    enero:1, febrero:2, marzo:3, abril:4, mayo:5, junio:6, julio:7, agosto:8, septiembre:9, octubre:10, noviembre:11, diciembre:12,
    // Portuguese
    janeiro:1, fevereiro:2, março:3, marco:3, abril:4, maio:5, junho:6, julho:7, agosto:8, setembro:9, outubro:10, novembro:11, dezembro:12,
    // French
    janvier:1, février:2, fevrier:2, mars:3, avril:4, mai:5, juin:6, juillet:7, août:8, aout:8, septembre:9, octobre:10, novembre:11, décembre:12, decembre:12
  };
  const words = lower.split(/[\s,\-]+/).filter(Boolean);
  let mon = null;
  for (const w of words){
    if (monthMap[w] != null){ mon = monthMap[w]; break; }
  }
  if (mon != null){
    const dayMatch = lower.match(/\b(\d{1,2})\b/);
    if (dayMatch){
      const dd = parseInt(dayMatch[1],10);
      const yMatch = lower.match(/\b(20\d{2})\b/);
      const yy = yMatch ? parseInt(yMatch[1],10) : 2026;
      const m2 = String(mon).padStart(2,"0");
      const d2 = String(dd).padStart(2,"0");
      return `${yy}-${m2}-${d2}`;
    }
  }
  return s;
}


function renderSchedule(){
  const el = document.getElementById("schedule");
  el.innerHTML = "";

  // Guard: show notice if backend returned one
  if (scheduleData && scheduleData.notice){
    const row = document.createElement("div");
    row.className = "match";
    row.innerHTML = `<div class="left"><div><b>Notice</b></div><div class="when">${escapeHtml(scheduleData.notice)}</div></div><div class="pill">i</div>`;
    el.appendChild(row);
    if (matchCountEl) matchCountEl.textContent = "0";
    if (pagerEl) pagerEl.style.display = "none";
    return;
  }

  const rawMatches = (scheduleData && Array.isArray(scheduleData.matches)) ? scheduleData.matches.slice() : [];

  // Build timestamps for sorting + next-match highlight
  const enriched = rawMatches.map(m => {
    const ts = safeParseTimestamp(m.date, m.time);
    return {...m, ts};
  }).filter(m => m.ts !== null);

  if (matchCountEl) matchCountEl.textContent = String(enriched.length);

  if (!enriched.length){
    const empty = document.createElement("div");
    empty.className = "match";
    empty.innerHTML = `
      <div class="left">
        <div><b>Notice</b></div>
        <div class="when">${L().schedule_empty}</div>
      </div>
      <div class="pill">—</div>
    `;
    el.appendChild(empty);
    if (pagerEl) pagerEl.style.display = "none";
    return;
  }

  enriched.sort((a,b)=>a.ts-b.ts);

  const now = Date.now();
  const upcoming = enriched.filter(m => m.ts >= now);
  const nextId = upcoming.length ? upcoming[0].id : null;

  // Pagination (Dallas + All Matches)
let pageMatches = enriched;

const totalPages = Math.max(1, Math.ceil(enriched.length / PAGE_SIZE));
if (totalPages <= 1){
  currentPage = 1;
  if (pagerEl) pagerEl.style.display = "none";
  if (pageIndicatorEl) pageIndicatorEl.textContent = "";
  if (prevPageBtn) prevPageBtn.disabled = true;
  if (nextPageBtn) nextPageBtn.disabled = true;
} else {
  if (currentPage > totalPages) currentPage = 1;

  const start = (currentPage - 1) * PAGE_SIZE;
  pageMatches = enriched.slice(start, start + PAGE_SIZE);

  if (pagerEl) pagerEl.style.display = "flex";
  if (pageIndicatorEl) pageIndicatorEl.textContent = `Page ${currentPage} of ${totalPages}`;
  if (prevPageBtn) prevPageBtn.disabled = (currentPage <= 1);
  if (nextPageBtn) nextPageBtn.disabled = (currentPage >= totalPages);
}


  pageMatches.forEach(m => {
    const row = document.createElement("div");
    row.className = "match" + (m.id === nextId ? " next" : "");

    const timeTxt = formatKickoffTime(m.time);
    const teamsTxt = (m.teams && String(m.teams).trim())
      ? m.teams
      : ((m.home || m.away) ? `${m.home || "TBD"} vs ${m.away || "TBD"}` : "TBD vs TBD");

    const venueTxt = m.venue ? ` • ${m.venue}` : "";

    row.innerHTML = `
      <div class="left">
        <div><b>${escapeHtml(m.stage || "Match")}</b> • ${escapeHtml(teamsTxt)}</div>
        <div class="when">${escapeHtml(m.date || "")} • ${escapeHtml(timeTxt)}${escapeHtml(venueTxt)}</div>
      </div>
      <div class="pill">${escapeHtml(m.id || "")}</div>
    `;
    el.appendChild(row);
  });
}


function updateMatchDayMode(){
  const isMatchDay = !!(scheduleData && scheduleData.is_match_day);

  if (isMatchDay){
    pillMode.textContent = "Mode: Match-day";
    const banner = (scheduleData && scheduleData.match_day_banner) ? scheduleData.match_day_banner : "Match-day hours";
    matchBanner.textContent = banner;
    matchBanner.classList.add("show");

    matchdayBox.textContent = "🏟️ Match-day mode is ON today. Expect higher traffic — reserve early!";
    matchdayBox.classList.add("show");
  } else {
    pillMode.textContent = "Mode: Standard";
    matchBanner.classList.remove("show");
    matchdayBox.classList.remove("show");
  }
}

// -----------------------
// Menu rendering
// -----------------------

function renderMenu(items){
  const el = document.getElementById("menu");
  el.innerHTML = "";

  if (!items || !items.length){
    const d = document.createElement("div");
    d.className = "menuitem";
    d.innerHTML = `
      <div class="menuTop">
        <div>
          <div class="name">⚽ —</div>
          <div class="desc">Menu not available.</div>
        </div>
        <div class="menuBadge">—</div>
      </div>
    `;
    el.appendChild(d);
    return;
  }

  const icons = ["⚽","🌮","🍗","🥤","🔥","🏟️","🌎","🥇"];
  items.forEach((it, idx) => {
    const d = document.createElement("div");
    d.className = "menuitem";

    const icon = icons[idx % icons.length];
    const name = escapeHtml(it.name || "");
    const desc = escapeHtml(it.desc || "");
    const price = escapeHtml(it.price || "");

    // Lightweight tags (cosmetic)
    const tags = [];
    const lower = ((it.name||"") + " " + (it.desc||"")).toLowerCase();
    if (lower.includes("spicy") || lower.includes("picante")) tags.push("Spicy");
    if (lower.includes("wings") || lower.includes("alitas") || lower.includes("asinhas")) tags.push("Share");
    if (lower.includes("nacho")) tags.push("Snack");

    d.innerHTML = `
      <div class="menuTop">
        <div>
          <div class="name">${icon} ${name}</div>
          <div class="desc">${desc}</div>
          <div class="menuMeta">
            ${tags.map(t => `<span class="menuTag">${escapeHtml(t)}</span>`).join("")}
          </div>
        </div>
        <div class="menuBadge">${price || "—"}</div>
      </div>
    `;
    el.appendChild(d);
  });
}



// simple HTML escaping (prevents broken DOM if text contains "<")
function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

// -----------------------
// Chat send
// -----------------------
async function sendMessage(){
  const text = msgEl.value.trim();
  if (!text) return;

  addBubble("user", text);
  history.push({role:"user", content:text});

  msgEl.value = "";
  msgEl.style.height = "44px";
  setSending(true);

  try{
    const res = await fetch("/chat", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        message: text,
        session_id: sessionId,
        language: lang,
        history // kept as a feature; server will safely ignore
      })
    });

    const data = await res.json().catch(() => ({}));
    const reply = (data && data.reply) ? data.reply : "Sorry — no reply received.";

    addBubble("assistant", reply);
    history.push({role:"assistant", content: reply});
  } catch(e){
    addBubble("assistant", "⚠️ Network error. Please try again.");
  } finally{
    setSending(false);
    msgEl.focus();
  }
}

sendBtn.addEventListener("click", sendMessage);

// Enter to send, Shift+Enter newline
msgEl.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

// Auto-grow textarea
msgEl.addEventListener("input", () => {
  msgEl.style.height = "44px";
  msgEl.style.height = Math.min(msgEl.scrollHeight, 130) + "px";
});

// -----------------------

// -----------------------
// Schedule scope toggle + search (Dallas ↔ All Matches)
// -----------------------
function setScope(newScope){
  scope = (newScope === "all") ? "all" : "dallas";
  localStorage.setItem("schedule_scope", scope);
  // Reset pagination when switching scope
  currentPage = 1;
  if (scopeDallasBtn) scopeDallasBtn.classList.toggle("active", scope === "dallas");
  if (scopeAllBtn) scopeAllBtn.classList.toggle("active", scope === "all");
  loadSchedule();
}
if (scopeDallasBtn) scopeDallasBtn.addEventListener("click", () => setScope("dallas"));
if (scopeAllBtn) scopeAllBtn.addEventListener("click", () => setScope("all"));

// Pagination controls (Dallas + All Matches)
if (prevPageBtn) prevPageBtn.addEventListener("click", () => { if (currentPage > 1){ currentPage--; renderSchedule(); } });
if (nextPageBtn) nextPageBtn.addEventListener("click", () => {
  if (!scheduleData || !Array.isArray(scheduleData.matches)) return;
  const totalPages = Math.max(1, Math.ceil(scheduleData.matches.length / PAGE_SIZE));
  

// -----------------------
// Menu pagination controls
// -----------------------
if (null){
  null.addEventListener("click", () => {
    if (!menuShowAll && menuPage > 1){
      menuPage--;
      renderMenu(window.menuDataList || []);
    }
  });
}
if (null){
  null.addEventListener("click", () => {
    if (!menuShowAll){
      const items = window.menuDataList || [];
      const totalPages = Math.max(1, Math.ceil((items.length || 0) / MENU_PAGE_SIZE));
      if (menuPage < totalPages){
        menuPage++;
        renderMenu(items);
      }
    }
  });
}
if (null){
  null.addEventListener("click", () => {
    menuShowAll = !menuShowAll;
    menuPage = 1;
    renderMenu(window.menuDataList || []);
  });
}
if (currentPage < totalPages){ currentPage++; renderSchedule(); }
});


// Team search (simple text input)
let _searchTimer = null;
function setScheduleQuery(q){
  scheduleQuery = normalizeScheduleSearch((q || "").trim());
  // Reset pagination when searching
  currentPage = 1;
  if (_searchTimer) clearTimeout(_searchTimer);
  _searchTimer = setTimeout(() => loadSchedule(), 250);
}
if (teamSearchEl){
  teamSearchEl.addEventListener("input", (e) => setScheduleQuery(e.target.value));
}

// -----------------------
// Clear conversation (UI-only reset, keeps session id)
// -----------------------
function clearConversation(){
  history.length = 0;
  chatEl.innerHTML = "";
  addBubble("assistant", L().welcome);
  history.push({role:"assistant", content: L().welcome});
  msgEl.value = "";
  msgEl.style.height = "44px";
  msgEl.focus();
}
if (clearBtn) clearBtn.addEventListener("click", clearConversation);

// Init
// -----------------------
(async function init(){
  applyLanguageToUI();

  // Start cinematic HERO banner rotation (UI-only)
  try { renderHero(); } catch(e) { console.warn('Hero banner init failed', e); }

  // Restore schedule scope UI
  if (scopeDallasBtn) scopeDallasBtn.classList.toggle("active", scope === "dallas");
  if (scopeAllBtn) scopeAllBtn.classList.toggle("active", scope === "all");

  // Init cinematic hero (UI-only)
  buildHero();

  // Load sidebar data
  await loadSchedule();
  await loadMenu();

  // Welcome message (feature preserved)
  addBubble("assistant", L().welcome);
  history.push({role:"assistant", content: L().welcome});

  // Ensure focus
  msgEl.focus();
})();
</script>
</body>
</html>